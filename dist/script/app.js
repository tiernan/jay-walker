"use strict";"serviceWorker"in navigator&&navigator.serviceWorker.register("service-worker.js").then(function(e){console.log("ServiceWorker registration successful with scope: ",e.scope)})["catch"](function(e){console.log("ServiceWorker registration failed: ",e)});var JayWalker;!function(e){var t;!function(e){function t(e){return new Promise(function(t,i){if(a[e])t(a[e]);else{var n=new Image;n.onerror=function(){i()},n.onload=function(){a[e]=n,t(n)},a[e]=null,n.src=e}})}function i(e){return new Promise(function(i,n){var a=[];e instanceof Array?e.forEach(function(e){a.push(t(e))}):t(e),Promise.all(a).then(i,n)})}function n(e){return a[e]}var a={};e.preload=i,e.get=n}(t=e.Resources||(e.Resources={}))}(JayWalker||(JayWalker={}));var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},JayWalker;if(function(e){function t(e){return e instanceof Array?e[Math.floor(Math.random()*e.length)]:e}function i(t,i){if(e.data[t])return void i(e.data[t]);switch(window.location.protocol){case"http:":case"https:":var n=new XMLHttpRequest;n.overrideMimeType("application/json"),n.open("GET",t,!0),n.onreadystatechange=function(){4===n.readyState&&200===n.status&&(e.data[t]=JSON.parse(n.responseText),i(e.data[t]))},n.send();break;case"file:":var a=document.createElement("script");a.type="text/javascript",a.onload=function(){i(e.data[t])},a.src=t.substring(0,t.length-2),document.head.appendChild(a);break;default:throw new Error("Unknown protocol")}}function n(e,t,i,n){this.w=e,this.h=t,this.radiusX=Math.floor(e/2),this.radiusY=Math.floor(t/2),this.spriteW=i?i:e,this.spriteH=n?n:t}function a(e,t){this.centerOffsetX=e,this.centerOffsetY=t}function s(e,t){this.radiusX=this.radiusX+e,this.radiusY=this.radiusY+t}function o(t,i,n,a,s,o){if(e[t])return new e[t](i,n,a,s,o);throw Error("Entity not found")}e.data={},e.userKeys=[],e.randomArrayElement=t,e.loadJSON=i,e.loadJSON("data/config.json",function(t){e.gridW=t.width,e.gridH=t.height,e.gridEdgeX=e.gridW-1,e.gridEdgeY=e.gridH-1,e.gridCellWidth=t.cellWidth,e.gridCellHeight=t.cellHeight,e.cellOffsetX=t.cellOffsetX,e.cellOffsetY=t.cellOffsetY,e.baseSpeed=t.baseSpeed,e.levels=t.levels});var r=function(){function t(t,i,n){this.sprite=t,this.x=i*e.gridCellWidth+e.cellOffsetX,this.y=n*e.gridCellHeight+e.cellOffsetY,this.cellX=i,this.cellY=n,this.frame=0,this.set=0}return t.prototype.render=function(t){t.drawImage(e.Resources.get(this.sprite),this.spriteW*this.frame,this.spriteH*this.set,this.spriteW,this.spriteH,this.x,this.y,this.spriteW,this.spriteH)},t}();e.Entity=r,r.prototype.centerOffsetX=0,r.prototype.centerOffsetY=0,n.call(r.prototype,50,50);var l=function(e){function t(t,i,n,a){e.call(this,t,i,n),this.speed=a,this.edgeY=this.y+this.h}return __extends(t,e),t}(r),c=function(t){function i(i,n){t.call(this,"images/char-boy-trim.png",i,n,1.2),this.limitX=e.gridCellWidth*e.gridW-this.w,this.limitY=e.gridCellHeight*e.gridH-this.h+e.cellOffsetY}return __extends(i,t),i.prototype.update=function(t){e.userKeys[37]?(this.x-=Math.ceil(t*e.gridCellWidth*this.speed),this.x<0&&(this.x=0)):e.userKeys[39]&&(this.x+=Math.ceil(t*e.gridCellWidth*this.speed),this.x>this.limitX&&(this.x=this.limitX)),e.userKeys[38]?(this.y-=Math.ceil(t*e.gridCellHeight*this.speed),this.y<e.cellOffsetY&&(this.y=e.cellOffsetY)):e.userKeys[40]&&(this.y+=Math.ceil(t*e.gridCellHeight*this.speed),this.y>this.limitY&&(this.y=this.limitY)),this.cellX=Math.floor(this.x/e.gridCellHeight),this.cellY=Math.floor(this.y/e.gridCellHeight),this.cellXa=this.cellX+1,this.cellXb=this.cellX-2,this.cellYa=this.cellY+1,this.cellYb=this.cellY-1,this.edgeX=this.x+this.w,this.edgeY=this.y+this.h},i}(l);e.Player=c,n.call(c.prototype,67,77,null,88),a.call(c.prototype,0,-10),c.prototype.names=["you"];var h=function(t){function i(i,n,a,s,o){t.call(this,i,o?e.gridW+n:-n,a,s),this.reverse=o,this.set=o?1:0}return __extends(i,t),i.prototype.update=function(t){!this.reverse&&this.x>e.gridW*e.gridCellWidth?(this.x=-2*e.gridCellWidth,this.cellX=-2):this.reverse&&this.x+this.spriteW<0?(this.x=e.gridW*e.gridCellWidth,this.cellX=e.gridW):(this.x+=(this.reverse?-1:1)*t*e.gridCellWidth*this.speed*e.baseSpeed,this.cellX=Math.floor(this.x/e.gridCellWidth))},i}(l);e.Enemy=h,h.prototype.names=["P.E. #1","Rude Boy","Natasha","Careless Driver"],h.prototype.actions=["hit","ran over","crashed into"];var u=function(e){function t(t,i,n,a){e.call(this,"images/enemy-bug-trim.png",t,i,n,a)}return __extends(t,e),t}(h);e.Bug=u,n.call(u.prototype,98,64,99,77),a.call(u.prototype,-15,-10),u.prototype.names=["Buster Bugsy","Dung Beetle #1","Dung Beetle #2","Your Worst Nightmare","Beetlejuice"],u.prototype.actions=["slimed","ate","bit"];var d=function(e){function t(t,i,n,a){e.call(this,"images/classic-car.png",t,i,n,a)}return __extends(t,e),t}(h);e.ClassicCar=d,n.call(d.prototype,148,63),s.call(d.prototype,-1,-1),d.prototype.names=["Jay Leno","80's Guy","The Fonz"];var f=function(e){function t(t,i,n,a){e.call(this,"images/muscle-car.png",t,i,n,a)}return __extends(t,e),t}(h);e.MuscleCar=f,n.call(f.prototype,147,69),s.call(f.prototype,-1,-3),f.prototype.names=["Clint Eastwood","Toretto","Burt Reynolds","Stirling Archer"];var p=function(e){function t(t,i,n,a){e.call(this,"images/taxi.png",t,i,n,a)}return __extends(t,e),t}(h);e.Taxi=p,n.call(p.prototype,146,75),s.call(p.prototype,0,-3),p.prototype.names=["Benny","Travis Bickle","Max","Corky"];var g=function(e){function t(t,i,n,a){e.call(this,"images/van.png",t,i,n,a)}return __extends(t,e),t}(h);e.Van=g,n.call(g.prototype,150,69),a.call(g.prototype,-10,0),s.call(g.prototype,-1,-10),g.prototype.names=["Krieger"];var m=function(e){function t(t,i,n,a){e.call(this,"images/truck.png",t,i,n,a)}return __extends(t,e),t}(h);e.Truck=m,n.call(m.prototype,298,80),a.call(m.prototype,60,0),s.call(m.prototype,-2,-6),m.prototype.names=["Bob","Larry"];var y=function(e){function t(t,i,n,a){e.call(this,"images/pickup.png",t,i,n,a)}return __extends(t,e),t}(h);e.Pickup=y,n.call(y.prototype,148,79),s.call(y.prototype,-1,-4),y.prototype.names=["Mike","Brent"];var v=function(t){function i(e,i,n,a,s,o){t.call(this,e,i,n,a,s),this.mode=o,this.timingOffset=0}return __extends(i,t),i.prototype.update=function(t){if(!this.reverse&&this.x>e.gridW*e.gridCellWidth)this.x=-2*e.gridCellWidth-this.timingOffset,this.finishedLoop();else if(this.reverse&&this.x+this.spriteW<0)this.x=e.gridW*e.gridCellWidth+this.timingOffset,this.finishedLoop();else if(this.x+=(this.reverse?-1:1)*t*e.gridCellWidth*this.speed*e.baseSpeed,this.mode){var i=t*e.gridCellWidth*this.chaseBonus;this.x+=i,this.addTimingOffset(i)}this.cellX=Math.floor(this.x/e.gridCellWidth)},i}(h);v.prototype.chaseBonus=.6;var x=function(e){function t(t,i,n,a,s){e.call(this,"images/sport-car.png",t,i,n,a,s)}return __extends(t,e),t.prototype.finishedLoop=function(){},t.prototype.addTimingOffset=function(){},t}(v);e.SportsCar=x,n.call(x.prototype,150,69),s.call(x.prototype,-1,-1);var b=function(e){function t(t,i,n,a,s){e.call(this,"images/enemy-police.png",t,i,n,a,s),this.frameCount=0,this.chasing=!0,this.timingOffset=0}return __extends(t,e),t.prototype.update=function(e){this.chasing&&(this.frameCount++,this.frameCount>=this.frameRate&&(this.chasing&&(2===this.frame?this.frame=1:this.frame=2),this.frameCount=0)),v.prototype.update.call(this,e)},t.prototype.finishedLoop=function(){this.timingOffset=0,this.mode||(this.chasing=!1,this.frame=0)},t.prototype.addTimingOffset=function(e){this.chasing&&!this.mode&&(this.timingOffset+=e)},t}(v);e.Police=b,n.call(b.prototype,150,69),b.prototype.frameRate=10,b.prototype.names=["Officer McDonuts","Chief Wiggum","David Starsky","Kenneth Hutchinson","Debrah Morgan","Sergeant Batista"],b.prototype.actions=["busted","caught","hit","crashed into","arrested"];var w=function(){function e(e,t,i){this.stage=e,this.w=t,this.h=i}return e.prototype.createCanvas=function(e,t,i,n){if("boolean"!=typeof t&&(t=!1),i||(i=1),n||(n="layer"),t)return this._createCanvasElement(e,i,n).getContext("2d");var a=this.stage.appendChild(this._createCanvasElement(e,i,n));return a.getContext("2d")},e.prototype._createCanvasElement=function(e,t,i){var n=document.createElement("canvas");return n.id=e,n.className=i,n.width=Math.round(this.w*t),n.height=Math.round(this.h*t),n},e}();e.CanvasFactory=w,e.createEntity=o;var k=function(){function e(e){e.textBaseline="middle",e.textAlign="center",e.lineWidth=3,e.strokeStyle="#000",e.fillStyle="#fff",this.hudHeight=40,this.lineHeight=6,this.context=e,this.queue=[],this.current=null}return e.prototype.pauseQueue=function(e){this._drawText(e,!0)},e.prototype.resumeQueue=function(){this.current?this._drawText(this.current.text,!0):this.clear()},e.prototype.queueText=function(e,t,i){t||(t=3),this.queue.push({callback:i,text:e,timeout:t}),this.current||this._nextText()},e.prototype.dequeueText=function(){this.current=this.queue.shift()},e.prototype.update=function(e){this.current&&(this.current.timeout-=e,this.current.timeout<0&&(this.clear(),this.current.callback&&this.current.callback(),this._nextText()))},e.prototype.clear=function(){this.context.clearRect(0,this.hudHeight,this.context.canvas.width,this.context.canvas.height)},e.prototype.style=function(e,t,i){i||(i="normal"),this.context.font=i+" "+e+"pt "+t,this.lineHeight=Math.round(e+.4*e)},e.prototype.color=function(e,t){this.context.fillStyle=e,this.context.strokeStyle=t},e.prototype.drawLives=function(e){this.context.save();var t=this.lineHeight;this.style(20,"Arial"),this.context.clearRect(this.context.canvas.width/2,0,this.context.canvas.width/2,this.hudHeight),this.context.strokeText("x "+e,this.context.canvas.width-40,25),this.context.fillText("x "+e,this.context.canvas.width-40,25),this.context.restore(),this.lineHeight=t},e.prototype._drawText=function(e,t){t&&this.clear();for(var i=this.lineHeight,n=e.split("\n"),a=this.context.canvas.width/2,s=this.context.canvas.height/2-(n.length-1)*i/2,o=0,r=n.length;o<r;o++)this.context.strokeText(n[o],a,s+o*i),this.context.fillText(n[o],a,s+o*i)},e.prototype._nextText=function(){this.dequeueText(),this.current&&this._drawText(this.current.text)},e}();e.TitleManager=k}(JayWalker||(JayWalker={})),!Promise)throw new Error("Browser unsupported");var JayWalker;!function(e){function t(){e.userKeys.length=0,ue=!1}function i(){ue=!0}function n(){oe=!1,ee.cancelAnimationFrame(N)}function a(){!he&&se&&re&&(oe=!0,N=ee.requestAnimationFrame(p))}function s(){te.hidden?n():a()}function o(){be.queueText("Ready",1),be.queueText("Set",1,i),be.queueText("Go",1)}function r(){re=!0,G=new e.Player(V[0],V[1]),Q?a():(t(),be.clear(),o(),a())}function l(t){switch(t.keyCode){case 37:case 38:case 39:case 40:ue&&(e.userKeys[t.keyCode]=!0)}}function c(t){switch(t.keyCode){case 13:case 32:return void(!Q&&se&&z?!re&&z&&r():B());case 27:return void(se&&re&&!Q&&d());case 37:case 38:case 39:case 40:e.userKeys[t.keyCode]=!1;break;case 49:console.log("Hard Mode Enabled"),e.baseSpeed=1.2,pe=-5;break;case 50:console.log("Normal Mode Enabled"),e.baseSpeed=1,pe=0;break;case 51:console.log("Easy Mode Enabled"),e.baseSpeed=1,pe=6;break;case 52:console.log("Wimp Mode Enabled"),e.baseSpeed=.8,pe=12;break;case 53:console.log("God Mode Enabled"),de=!0,e.baseSpeed=1,pe=500;break;case 54:le=!le,T(),console.log("Blood "+(le?"Enabled":"Disabled"));break;case 55:ce=!ce,console.log("Leave Trails "+(ce?"Disabled":"Enabled"));break;case 56:$?u():h();break;case 57:!Q&&oe&&(console.log("CHEATER!"),de=!0,z++,be.drawLives(z));break;default:console.log("Invalid key: "+t.keyCode)}}function h(){console.log("8-bit Mode Enabled"),$=xe.createCanvas("bit",!0,.25),$.mozImageSmoothingEnabled=!1,$.webkitImageSmoothingEnabled=!1,$.imageSmoothingEnabled=!1,we.mozImageSmoothingEnabled=!1,we.webkitImageSmoothingEnabled=!1,we.imageSmoothingEnabled=!1,Ee.mozImageSmoothingEnabled=!1,Ee.webkitImageSmoothingEnabled=!1,Ee.imageSmoothingEnabled=!1,_(),T()}function u(){console.log("8-bit Mode Disabled"),$=null,we.mozImageSmoothingEnabled=!0,we.webkitImageSmoothingEnabled=!0,we.imageSmoothingEnabled=!0,Ee.mozImageSmoothingEnabled=!0,Ee.webkitImageSmoothingEnabled=!0,Ee.imageSmoothingEnabled=!0,_(),T()}function d(){he?(he=!1,be.resumeQueue(),a()):(he=!0,be.pauseQueue("-PAUSED-"),n())}function f(){T(),ee.requestAnimationFrame(p)}function p(e){ee.cancelAnimationFrame(N),void 0===e&&(e=Date.now()),K=e,ae=0,P=e,N=ee.requestAnimationFrame(Z)}function g(e){var t=N;y(e),v((e-K)/1e3),_(),K=e,t!==N?console.log("Out of sync, skipping frames!"):oe&&(N=ee.requestAnimationFrame(g))}function m(){g(Date.now())}function y(e){e>P+1e3?(D=ae,P=e,ae=0,D<45&&console.log("Severe FPS drop!"),ne.textContent=String(D)):ae++}function v(e){be.update(e),x(e),w(),Y()}function x(e){for(var t=0,i=fe.length;t<i;t++)b(fe[t],e);G.update(e)}function b(e,t){e.update(t)}function w(){fe.forEach(k)}function k(e){e.cellY>=G.cellYb&&e.cellY<=G.cellYa&&e.cellX>=G.cellXb&&e.cellX<=G.cellXa&&E(e)}function E(e){e.edgeX=e.x+e.w,(e.y<=G.y&&e.edgeY>=G.y||G.y<=e.y&&G.edgeY>=e.y)&&(e.x<=G.x&&e.x+e.w>=G.x||G.x<=e.x&&G.edgeX>=e.x)&&C(e)}function C(e){var t=e.x+e.w/2+e.centerOffsetX,i=e.y+e.h/2+e.centerOffsetY,n=G.x+G.w/2+G.centerOffsetX,a=G.y+G.h/2+G.centerOffsetY,s=n-t,o=a-i,r=W(s,o),l=Math.atan2(o,s),c=Math.abs(l/Math.PI)>.5?-1:1,h=l>0?1:-1;r+pe<=S(G,l,c,h)+S(e,-l,-c,-h)-me&&O(e,n,a,l)}function W(e,t){return Math.sqrt(Math.pow(e,2)+Math.pow(t,2))}function S(e,t,i,n){if(!e.centerOffsetY&&e.radiusX===e.radiusY)return e.radiusX;var a=(e.radiusX+i*e.centerOffsetX)*Math.cos(t),s=(e.radiusY+n*e.centerOffsetY)*Math.sin(t);return W(a,s)}function O(e,t,i,a){re=!1,I(t,i,a),n(),Q?r():(be.drawLives(--z),be.pauseQueue([M(G,e),z?"Try again?":"GAME OVER"].join("\n")))}function M(t,i){var n=e.randomArrayElement(t.names),a=e.randomArrayElement(i.names),s=e.randomArrayElement(i.actions);return[a,s,n].join(" ")}function Y(){Q||0!==G.cellY||G.y!==e.cellOffsetY||(U++,e.levels[U]?(t(),n(),q(G.cellX)):(Q=!0,be.drawLives("∞"),de?be.pauseQueue("YOU CHEATED!\nTry again without cheats!"):be.pauseQueue("YOU WON!")))}function _(){we.clearRect(0,0,ye,ve),G.render(ke);for(var e=0,t=fe.length;e<t;e++)fe[e].render(ke);$?($.drawImage(ke.canvas,0,0,$.canvas.width,$.canvas.height),we.drawImage($.canvas,0,0,ye,ve),$.clearRect(0,0,$.canvas.width,$.canvas.height)):we.drawImage(ke.canvas,0,0),ce&&ke.clearRect(0,0,ye,ve)}function T(){Ee.clearRect(0,0,ye,ve);for(var t=0;t<e.gridH;t++)H(t);$&&X()}function X(){$.drawImage(Ee.canvas,0,0,$.canvas.width,$.canvas.height),Ee.drawImage($.canvas,0,0,ye,ve),$.clearRect(0,0,$.canvas.width,$.canvas.height)}function H(t){for(var i=0;i<e.gridW;i++)Ee.drawImage(e.Resources.get(ge[t]),101*i,83*t)}function I(t,i,n){le&&(Ee.save(),Ee.translate(t,i),Ee.rotate(n),Ee.drawImage(e.Resources.get("images/blood.png"),-150,-98),Ee.restore(),$&&X())}function A(){ee.requestAnimationFrame(R),te.addEventListener("keydown",l),te.addEventListener("keyup",c),be.pauseQueue("Jay Walker\nHit ENTER to play"),be.color("#fff","#000")}function R(e){e?(console.log("Using high resolution main loop"),Z=g):(console.log("Using support main loop"),Z=m)}function B(){se=!1,de=!1,re=!1,Q=!1,j=null,U=0,z=3,be.drawLives(z),q()}function q(t){t&&(j=t),ee.cancelAnimationFrame(N),fe.length=0,e.loadJSON("data/"+e.levels[U],L)}function L(t){se=!0,oe=!0,V=t.origin,G=new e.Player(null==j?V[0]:j,V[1]),ge.length=0;for(var i=0,n=t.layout.length;i<n;i++)J(t.layout[i],i);for(var a=t.startFrame;a>0;)v(1),a--;be.clear(),be.queueText(t.name,1),o(),T(),_(),re=!0,ee.requestAnimationFrame(f)}function J(e,t){ge[t]=e.material,e.enemies&&F(e,t)}function F(t,i){for(var n=0,a=t.enemies.length;n<a;n++){var s=t.enemies[n],o=e.randomArrayElement(s.type);fe.push(e.createEntity(o,s.delay,i,t.speed,t.reverse,s.mode))}}var P,D,K,N,Q,j,z,U,G,V,Z,$,ee=window,te=document,ie=te.getElementById("stage"),ne=te.getElementById("fps-display"),ae=0,se=!1,oe=!0,re=!1,le=!0,ce=!0,he=!1,ue=!1,de=!1,fe=[],pe=0,ge=[],me=2,ye=1010,ve=606,xe=new e.CanvasFactory(ie,ye,ve),be=new e.TitleManager(xe.createCanvas("text")),we=xe.createCanvas("fg"),ke=xe.createCanvas("fg-buffer",!0),Ee=xe.createCanvas("bg",null,null,"background");be.style(48,"Impact"),be.color("#f70","#000"),be.pauseQueue("Loading..."),Ee.fillStyle="#fff",Ee.fillRect(0,0,ye,ve),te.addEventListener("visibilitychange",s,!1),e.Resources.preload(["images/stone-block.png","images/water-block.png","images/grass-block.png","images/enemy-bug-trim.png","images/char-boy-trim.png","images/enemy-police.png","images/sport-car.png","images/muscle-car.png","images/taxi.png","images/pickup.png","images/truck.png","images/van.png","images/classic-car.png","images/blood.png"]).then(A,function(){console.log("failed preload")})}(JayWalker||(JayWalker={}));